version: '3.8'

services:
  migrator:
    build:
      context: .
      dockerfile: Dockerfile
      target: migrator
    restart: no
    environment:
      - NODE_ENV=production
  rss-builder-api:
    build:
      context: .
      dockerfile: Dockerfile
      target: api
    ports:
      - '5001:5000'
    environment:
      - NODE_ENV=production
      - PORT=5000
      - SWAGGER_USERNAME=admin
    restart: unless-stopped
    depends_on:
      migrator:
        condition: service_completed_successfully
  rss-builder-scheduler:
    build:
      context: .
      dockerfile: Dockerfile
      target: scheduler
    environment:
      - NODE_ENV=production
    restart: unless-stopped
    depends_on:
      migrator:
        condition: service_completed_successfully
